!function(){var t,e,n,o=0,r=[],i=!1,a=!1,s=!1,u=!1,d=!1,c=!1,l=void 0,f=void 0,p=void 0,v=void 0,m=void 0,h=void 0,y=void 0,g=void 0,b=function(){console.log("Load comment not defined")},_=function(){console.log("Save annotation not defined")},w=function(){console.log("onAnnotationsDownloaded not defined")};function x(){$(".topbar:first .cursor:first").click()}function A(t){localStorage.setItem(t+"/version",0),localStorage.setItem(t+"/scale",1),localStorage.setItem(t+"/roate",0),localStorage.setItem(t+"/dirty",0),localStorage.setItem(t+"/annotations","[]")}function S(t){var e=P(t,t+"/version");return isNaN(e)&&bootbox.alert("Cookie1 must have been se, plz contact support"),e}function C(t){var e=P(t,t+"/dirty");return isNaN(e)&&bootbox.alert("Cookie2 must have been set for "+t+", plz contact support"),e}function E(t){if(1!=C(t)){var e=P(t,t+"/version");e+=1,localStorage.setItem(t+"/version",e),localStorage.setItem(t+"/dirty",1)}}function k(t){localStorage.setItem(t+"/dirty",0)}function L(t,e){localStorage.setItem(t+"/version",e)}function P(t,e){O(t,e);var n=localStorage.getItem(e);return isNaN(n)||(n=parseFloat(n)),n}function I(t,e,n){var o=O(t,e);"dirty"!=o&&"version"!=o||(bootbox.alert("Should not happend"),console.trace()),localStorage.setItem(e,n)}function O(t,e){var n=e.replace(t+"/","");return-1==["version","annotations","dirty","scale","rotate","pen/size","pen/color","text/size","text/color"].indexOf(n)&&(console.trace(),bootbox.alert("Please report this issue2 with "+e+" for "+t)),n}function M(){e&&e.length>0&&($("#annotated-doc-conatiner").hide(),i=!1,e.hide(),$(".router-outlet").show(),_("Leaving"))}$(function(){var t=!1;$(document).on("mouseup","#viewer",function(e){2!=e.button&&1==o&&setTimeout(function(){var n=window.getSelection();if(1!=o||"Range"!=n.type||0==n.baseOffset&&0==n.focusOffset){var r=$(".toolbar .pen").hasClass("active"),i=$(".toolbar .cursor").hasClass("active");$(".toolbar .comment").hasClass("active")?t=!!t:r||i||x()}else{var a=$(".annotation-options.ContextMenuPopup");a.css({left:e.pageX-a.width()/2,top:e.clientY+12}).show(),u=!0}},10)})});var N=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={exports:{},id:o,loaded:!1};return t[o].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=t,n.c=e,n.p="",n(0)}([function(O,N,j){try{var T,R,D,B=U(j(2)),q=(U(j(4)),function(){}),F=void 0,z=!1;$(document).height(),$(document).width(),window.init_doc_comments=function(){e=$("#comment-wrapper"),T=e.find("#commentText"),R=e.find(".comment-list:first"),D=e.find(".comment-list-container:first"),T.focus(function(){c=!0}),x(),$(window).unbind("unload",M),$(window).bind("unload",M),n=$("#content-wrapper")},t=localStorage.getItem("user"),t=JSON.parse(t);var W=!1;function U(t){return t&&t.__esModule?t:{default:t}}var Y=B.default.UI,X={};B.default.setStoreAdapter(new B.default.LocalStoreAdapter);var J=0,V=void 0,G=B.default.getStoreAdapter();ft="",function(){function t(t,e,n,o){if(0==t.length&&(t=rt()),0!=t.length||0!=n.length){(t=(t=t.filter(function(t){return"point"!=t.type||t.sub_type})).concat(n)).forEach(function(t){t.class="Annotation"});var r="";Array.isArray(t)?(r=JSON.stringify(t),I(z,z+"/annotations",r),L(z,e),k(z),dt(o)):bootbox.alert("invalid annotations")}else o&&o.first_time&&dt(o)}w=function(e,n){var o=e.comments;Array.isArray(o)||(o=[],console.log("Why not comments"));var r=S(z);e.annotations||(e.annotations=[]);var i=void 0,a=C(z);e.version>r?1==a?(i="Document annotation version="+e.version+" available from server,",i+="<br>You have older version="+r+" at local.",i+="<br>If you download, it will discard your recent changes,",i+="<br>Do you still want to download?",bootbox.confirm(i,function(r){t(r?e.annotations:[],e.version,o,n)})):t(e.annotations,e.version,o,n):t([],e.version,o,n)}}(),function(){function t(t){console.log(t)}_=function(e){if(q(1),z){if(1==C(z)){var n=S(z),o={id:doc_id,doc_id:z};if(delete o.reset,"reset"==e)o.reset=1;else{var r=localStorage.getItem(z+"/annotations");if(!r||"[]"==r)return void console.log("No annotations");0==n&&(E(z),L(z,1)),o.annotations=r,o.version=n}dn_rpc_object({data:{args:{app:"documents",model:"AnnotationDocument",method:"add_annotation"},params:o},no_loader:1,onSuccess:function(t){!function(t,e){if("done"!=t){if(isNaN(t))return bootbox.alert("Could not save:"),void console.log(t);var n=S(z);ft="Server already has version="+t,ft+="<br>Do you want to overwrite server version with local="+n+"?",bootbox.confirm(ft,function(e){e&&(L(n=t+1),_())})}else"reset"==e?(A(z),ut()):k(z),console.log("Saved")}(t,e)},onError:t,type:"post"})}}else console.log("saveAnnotationsAtServer must be called after document id is set")},window.saveAnnotationsAtServer=_,$("body").on("click",".doc-saver",function(){_()})}(),$("body").on("click",".cb-container.autosave input",function(){$(this).prop("checked")&&_()}),$("body").on("click",".toolbar .back",function(){M()}),$("body").on("click",".doc-clearer",function(){ft="Do you want to erase all annotations on document.",ft+="<br>Warning: it will disable autosave to not affect the online vesion.",bootbox.confirm(ft,function(t){t&&(function(t){localStorage.setItem(t+"/version",0),localStorage.setItem(t+"/annotations","[]")}(z),$(".cb-container.autosave input").prop("checked",!1),ut())})}),$("body").on("click",".doc-reseter",function(){ft="Do you want to erase all annotations on document.",ft+="<br>Warning: It will also reset.",bootbox.confirm(ft,function(t){if(t){var e=localStorage.getItem(z+"/annotations");e=(e=JSON.parse(e)).filter(function(t){return"point"==t.type&&!t.sub_type}),e=JSON.stringify(e),localStorage.removeItem(z+"/annotations"),localStorage.setItem(z+"/annotations",e),E(z),_("reset")}})}),$("body").on("click",".ContextMenuPopup.toolbar:first .copy:first",function(){document.execCommand("copy"),$(this).parent().parent().hide()}),$(document).mousedown(function(t){if(2!=t.button){var e=$(t.target);c&&0==e.closest("#comment-wrapper").length&&(c=!1,b()),!u||e.is(".ContextMenuPopup button")||e.is(".ContextMenuPopup .colored")||$(".ContextMenuPopup").hide(),$(".topbar:first .pen:first").hasClass("active")?r.length>0&&0==e.closest("#viewer").length&&q():($(".pdfViewer").css("cursor","default"),F&&0==e.closest("#comment-wrapper").length?(F=void 0,$(".comment-list-form").hide()):$(".toolbar .comment").hasClass("active")&&0==e.closest("#viewer").length&&x())}}),$("body").on("click",".cell.colored",function(){var t=$(this),e=t.attr("hex").substring(1);p?p.color!=e&&(p.color=e,G.editAnnotation(z,f,p).then(function(e){t.append($("#applied_color").show())})):($(".topbar .pen-color:first").css("background",e),$(".topbar .pen-color:first").attr("color",e),H(null,e),t.append($("#applied_color").show()))}),$(".notification-list:first").on("click, li.list-group-item contact",function(){console.log(1344)});var H=function(t,e){},Z="top",K="left",Q=void 0;function tt(t,e){for(var n in t=t.filter(function(t){return"point"==t.type&&!t.sub_type})){var o=t[n],r="<div db_id="+o.id+" point_id="+o.uuid+' class="new_comments_count"',i=o.y*Q-15,a=o.x*Q+15,s=Z+":"+i+"px;"+K+":"+a+"px;";0==o.counter&&(s+="display:none;"),r+=' style="'+s+'" comment_count="'+o.counter+'">'+o.counter+"</div>",$("#pageContainer"+e+" .canvasWrapper").append(r)}}function et(){e.hide(),i=!1,localStorage.removeItem(z+"/shown_comment_type")}function nt(t){t&&(a=t),"notes"==a?e.find(".title:first").html("Personal Notes"):e.find(".title:first").html("Comments"),e.show(),F?$(".comment-list-form").show():$(".comment-list-form").hide(),i=a,$(".comment-header").offset().top;try{parseInt(D.css("padding-bottom"))}catch(t){}localStorage.setItem(z+"/shown_comment_type",i)}function ot(){site_functions.hideLoader("loaddocwaiter")}function rt(){var t=P(z,z+"/annotations");return t=t?JSON.parse(t):[]}function it(){T.html(""),T.parent().show(),R.scrollTop(999999e3),T.focus()}function at(t,e){t.counter=0,st(t,0)}function st(t,e,n){var o=P(z,z+"/annotations");for(var r in o=o?JSON.parse(o):[])if(o[r].uuid==t.uuid){var i=0;if(0!=e&&(i=e,o[r].counter&&(i+=o[r].counter)),t.counter=i,o[r].counter=i,!n){var a=$('.new_comments_count[point_id="'+t.uuid+'"]');0==i?a.hide():a.show(),a.html(i).attr("comment_count",i)}localStorage.setItem(z+"/annotations",JSON.stringify(o));break}}function ut(n){if(t=window.current_user.cookie,n&&n.first_time)if(e=$("#comment-wrapper"),T=e.find("#commentText"),R=e.find(".comment-list:first"),D=e.find(".comment-list-container:first"),d=n.type+"-"+n.id+".pdf",z=n.type+"-"+n.id+"-"+t.id+".pdf",doc_id=n.id,X.documentId=z,W=!1,localStorage.getItem(z+"/dirty")||A(z),"meeting"==n.type||"topic"==n.type){var o=S(z);dt(n),setTimeout(function(){var t=doc_id;t={args:{app:"documents",model:"AnnotationDocument",method:"get_annotations"},no_loader:1,params:{id:doc_id,doc_id:z,version:o}},dn_rpc_object({data:t,no_loader:1,onSuccess:function(t){n.first_time=void 0,w(t,n)},onError:function(t){console.log(t)}})},2e3)}else dt(n);else setTimeout(dt,100)}function dt(t){try{if(t&&t.first_time){"meeting"==t.type||"topic"==t.type?window.show_annotation=!0:window.show_annotation=!1,$(".topbar:first .annotation_button").hide(),$("#content-wrapper").hide(),$(".strt_sign.pdfjs").hide(),$(".sign_completed.pdfjs").hide(),$(".router-outlet").hide(),$(".doc-reseter").hide(),$(".toolbar.topbar:first").show(),$("#annotated-doc-conatiner").show(),et(),function(){function t(t,e){t=parseFloat(t,10),e=parseInt(e,10),$("#viewer").width(),X.scale,(X.scale!==t||X.rotate!==e)&&(X.scale=t,X.rotate=e,I(X.documentId,X.documentId+"/scale",X.scale),P(X.documentId,X.documentId+"/scale"),I(X.documentId,X.documentId+"/rotate",X.rotate%360),ut())}var e=document.querySelector(".toolbar select.scale");function n(){t(e.value,X.rotate)}e.addEventListener("change",n),document.querySelector(".toolbar .rotate-ccw").addEventListener("click",function(){t(X.scale,X.rotate-90)}),document.querySelector(".toolbar .rotate-cw").addEventListener("click",function(){t(X.scale,X.rotate+90)}),$("body").on("click",".toolbar:first .zoomin",function(){if(!(X.scale>=5)){var t=e.children[e.selectedIndex];e.value=$(t).next().val(),n()}}),$("body").on("click",".toolbar:first .zoomout",function(){if(!(X.scale<=.25)){var t=e.children[e.selectedIndex];e.value=$(t).prev().val(),n()}})}();var e=$(".toolbar select.scale:first");if((X={documentId:z,scale:P(z,z+"/scale"),rotate:P(z,z+"/rotate"),pdfDocument:null}).rotate||(X.rotate=360,I(z,z+"/rotate",360)),X.scale||(X.scale=1,I(z,z+"/scale",1)),e.val(X.scale),!t.type)return bootbox.alert("Invalid document data ",t),void ot();if(t.url){var n=window.site_config.server_base_url+t.url;console.log(window.site_config.server_base_url,t.url,n),t.doc=n}else{t.doc.startsWith("data:application/pdf;base64,")&&(t.doc=t.doc.replace("data:application/pdf;base64,",""));for(var r=atob(t.doc),i=new Uint8Array(r.length),a=0;a<r.length;a++)i[a]=r.charCodeAt(a);t.doc=i}X.document_data=t,PDFJS.getDocument(t.doc).then(function(t){console.log(Date(),(new Date).getMilliseconds(),"got doc data at client to show"),V=t,$(".page-count").html(V.numPages),V.numPages>1&&$(".page-next-btn").removeAttr("disabled"),s(V)})}else{if(!X.document_data)return bootbox.alert("Invalid render options data ",X),void ot();X.document_data.doc,z=X.documentId,s(V)}function s(e){if(!e)return alert("PDF not loaded"),void ot();X.pdfDocument=e;var n=document.getElementById("viewer");n.innerHTML="",J=e.pdfInfo.numPages;for(var r=0;r<J;r++){var i=Y.createPage(r+1);n.appendChild(i)}Q=$("select.scale").val();var a=X.rotate%360;switch(function(t){var e=X.document_data,n=e.type;if(0!=t||"meeting"!=n&&"topic"!=n)o=0,$(".annot-toggler").hide(),"meeting"!=n&&"topic"!=n||(o=2),X.showAnnotations=!1,$(".topbar:first .annotation_button").hide(),"signature"==e.type&&($(".strt_sign").attr("doc_id",e.id),"Pending"==e.mp_signature_status&&($(".sign_completed.pdfjs").hide(),$(".strt_sign.pdfjs").show()),"Completed"==e.mp_signature_status&&($(".strt_sign.pdfjs").hide(),$(".sign_completed.pdfjs").show()));else{o=1,X.showAnnotations=!0;var r=P(X.documentId,X.documentId+"/pen/size")||1,i=P(X.documentId,X.documentId+"/pen/color")||"#000000";H(r,i),$(".topbar:first .annotation_button").show(),$(".annot-toggler").show()}}(a),a){case 90:Z="right",K="top";break;case 180:Z="bottom",K="right";break;case 270:Z="left",K="bottom"}function s(e,n){1==n&&(first_page_rendered=1,t&&t.first_time&&$("body").addClass("pdf-viewer"),$("#content-wrapper").show(),console.log(Date(),(new Date).getMilliseconds()),ot()),1==o&&tt(e,n),n==J&&function(){if(t&&t.first_time){var e=window.socket_manager;e.execute_on_verified(function(){var t=e.notificationList;$(".canvasWrapper .new_comments_count").each(function(e,n){var o={res_app:"documents",res_model:"PointAnnotation",res_id:parseInt($(n).attr("db_id"))};for(var r in t)t[r].address.res_app==o.res_app&&t[r].address.res_model==o.res_model&&t[r].address.res_id==o.res_id&&(console.log(e,r,t[r].count,134),$(n).attr("counter",$(n).attr("counter")+t[r].count))})})}}()}Y.renderPage(1,X,function(t,e){s(t,e);for(var n=2;n<=J;n++)Y.renderPage(n,X,function(t,e){s(t,e)})})}window.show_annotation?($(".annotationLayer").show(),$(".annotation_button").show()):($(".annotationLayer").hide(),$(".annotation_button").hide())}catch(t){console.log(t)}}q=function(t){if(r.length>0){var e=P(z,z+"/annotations");e=JSON.parse(e);var n=r[0];e=e.filter(function(t){return 1!=t.to_merge});for(var o=1;o<r.length;o++)n.lines=n.lines.concat(r[o].lines);n.to_merge=0,e.push(n),localStorage.setItem(z+"/annotations",JSON.stringify(e)),r=[],n={},t||dt()}},ct=void 0,lt=void 0,H=function(t,e){var n=!1;t&&"number"!=typeof t&&(t=parseInt(t)),e&&6==e.length&&(e="#"+e),t&&ct!==t&&(n=!0,ct=t,I(X.documentId,X.documentId+"/pen/size",ct),document.querySelector(".toolbar .pen-size").value=ct),e&&lt!==e&&(n=!0,lt=e,I(X.documentId,X.documentId+"/pen/color",lt),$(".toolbar .pen-color:first").css("background-color",lt),$(".toolbar .pen-color:first").attr("color",e),$("select.pen-size").css("color",e),$("select.pen-size option").css("color",e)),n&&Y.setPen(ct,lt)},$("body").on("click",".toolbar .pen-color:first",function(t){var e=$(".topbar:first").width(),n=$(".ColorPalettePopup:first"),o=this.getBoundingClientRect(),r={top:o.y+20};e/2>o.x?r.left=o.x:r.left=o.x-n.width(),n.css(r).show();var i=$(this).attr("color");n.find('div[hex="'+i+'"]:first').click()}),$("body").on("change",".toolbar .pen-size:first",function(t){H(t.target.value,lt)}),function(){var t="cursor";function e(e,n){Y.disablePoint();var o=$(".toolbar button.active");if(o.length>0)switch(o.removeClass("active"),t){case"cursor":Y.disableEdit();break;case"draw":Y.disablePen();break;case"text":Y.disableText();break;case"point":Y.disablePoint();break;case"area":case"highlight":case"strikeout":case"underline":Y.disableRect()}switch($(n).addClass("active"),t=e,e){case"cursor":Y.enableEdit();break;case"draw":Y.enablePen();break;case"text":Y.enableText();break;case"point":$(".pdfViewer").css("cursor","crosshair"),Y.enablePoint();break;case"area":case"highlight":case"strikeout":case"underline":Y.enableRect(e)}}$("body").on("click",".toolbar.topbar:first button, .toolbar.annotation-options:first button",function(t){var n=$(".topbar:first .active"),o=$(t.target);if((o=o.closest("button")).hasClass("pen")&&n.hasClass("pen"))x();else{var r=$(t.target).closest("[data-tooltype]").data("tooltype");r&&e(r,t.target)}o.hasClass("comment")&&(s=!!o.hasClass("personal")&&"personal")})}(),function(r,i){r.on_annotation_comment_received=function(t){var n=$("#annotated-doc-conatiner");if(!(n.length<1)&&(n=n.is(":visible"))&&1==o&&n&&t.point.comment_doc_id==d){var r=D.attr("annotation-id");if(t.new_point){t.point.counter=1;var i=rt();i.push(t.point),i=JSON.stringify(i),I(z,z+"/annotations",i),Y.renderPage(t.point.page,X,function(n,o){G.addComment(z,t.point.uuid,t.point.comment,1).then(function(t){S(t,1),e.find(".comment-list-item:last").css({background:"green",color:"white"})}),tt(n,o),st(t.point,1,1)})}else t.point.uuid==r?(G.addComment(z,t.point.uuid,t.point.comment,1).then(function(t){S(t,1),e.find(".comment-list-item:last").css({background:"green",color:"white"})}),at(t.point)):(G.addComment(z,t.point.uuid,t.point.comment,1),st(t.point,1))}};var s=localStorage.getItem("user");function c(t){W=1,setTimeout(function(){t?l(t):(nt(a),T.closest("form").hide())},11)}function _(t,e,n){var o=i.createElement("div");for(var r in o.classList.add("groupcomment"),t){var a=A(t[r]);o.appendChild(a)}$(o).attr("annotationId",e),D.append(o)}function w(t){D.html(""),t.forEach(S)}s=JSON.parse(s),$("body").on("keyup","#commentText",function(e){if(F){if(!e.shiftKey&&13==e.keyCode){if(!r.should_save)return void(r.should_save=!0);y=[],$(".active-mention a.mention").each(function(t,e){let n=$(e).attr("mentioned_id");-1==y.indexOf(n)&&y.push(parseInt(n))}),e.preventDefault();var n=T.html();if(""==(n=n.substr(0,n.length-1)))return void T.html("");var o={date_time:new Date,user_name:t.name,uid:t.id,content:n};if(!o.content)return!1;G.addComment(z,F,o).then(function(t){S(t,1)})}}else console.log("Comment not added because, no active annotationId")}),b=function(t){D.html(""),D.removeAttr("annotation-id");var e=!1;"notes"==a&&(e="personal"),G.getPointAnnotations(z,e).then(function(e){(e=e.annotations).sort(function(t,e){return t.page-e.page||t.y-e.y||t.x-e.x});var n=-1,o=-1,r=e.length;for(var i in e)++n,G.getComments(z,e[n].uuid).then(function(n){var i=e[++o];_(n,i.uuid,i.sub_type),o+1==r&&c(t)});-1==n&&c(t)})};var x=!1;function A(t){var e=i.createElement("div");e.className="comment-list-item",t.date_time=r.dt_functions.standeredTime(t.date_time);var n='\n\t\t\t\t\t\t<div class="user-pic-time-infoWrapper">\n\t\t\t\t\t\t\t<div class="userSmpic icon-user-single">\n\t\t\t\t\t\t\t\t<img class="img-fluid" id="navbar-profile-img" src="">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="user-time-info">\n\t\t\t\t\t\t\t\t<span class="user">'+t.user_name+'</span>\n\t\t\t\t\t\t\t\t<span class"time">'+t.date_time+"</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>"+t.content+"</div>\n                    ";return $(e).attr("comment-id",t.uuid),$(e).attr("annotation",t.annotation),e.innerHTML=n,e}function S(t,e){var n=A(t);D.append(n),e&&it()}$("body").on("click","#comment-wrapper .buttons",function(t){t.preventDefault(),u=!0,x=$(this).closest(".comment-list-item"),$(".update-comment:first").css({top:t.pageY,left:t.pageX}).show()}),$("body").on("click",".annotation_button.unread",function(){for(var t=$(".canvasWrapper .new_comments_count"),e=t.length,n=0;n<e;n++){var o=t.eq(n);if(parseInt(o.html())>0){l(o.attr("point_id"));break}}}),$("body").on("click",".update-comment:first .delete",function(t){var e=x.closest(".groupcomment"),n=x.attr("comment-id"),o=x.attr("annotation");G.deleteComment(z,o,n).then(function(){1==e.children(".comment-list-item").length?e.remove():x.remove(),u=!1,$(".update-comment").hide()})}),$("body").on("click",".show-all-comments",function(){setTimeout(et,50)}),l=function(t){if(W){var e=void 0;if(e="string"==typeof t?t:t.attr("annotationId")){var o=$("svg.annotationLayer").find('svg[data-pdf-annotate-id="'+e+'"]');if(o.length>0){var r=$('.canvasWrapper .new_comments_count[point_id="'+e+'"]');setTimeout(function(){n.scrollTop(0);var t=r.closest(".canvasWrapper"),e=t.height()*(t.closest(".page").index()+1),i=r[0],a=parseFloat(i.style.top)-100,s=parseFloat(i.style.left)-100,u=e+a;n.scrollLeft(s),n.animate({scrollTop:u},500),m(o[0])},15)}else console.log(target,"Not found")}else console.log("Invalid point id")}else b(t)},$("body").on("click","#comment-wrapper .groupcomment",function(t){$(t.target).is(".buttons")||l($(this))}),h=function(t){G.getAnnotation(z,f).then(function(e){if(p=e,function(t){var e=t.getAttribute("data-pdf-annotate-type");return["point"].indexOf(e)>-1}(t))g(e);else{var n=$(".colors.ContextMenuPopup:first"),o=$(t).position(),r=$("#pdf-annotate-edit-overlay:visible").width(),i=n.width(),a=o.left+r/2-i/2,s=$(t).attr("fill");s||(s=$(t).attr("stroke")),"none"!=s&&s||(s="#000000");var d=n.find('.row>.cell[hex="'+s+'"]');0==d.length?$("#applied_color").hide():d.append($("#applied_color").show()),n.css({left:a,top:o.top+30}).show(),u=!0}})},g=function(t){F=f,G.getComments(z,f).then(w).then(function(){if(t.counter>0){var n=e.find(".comment-list-item").length;n=n-t.counter-1,e.find(".comment-list-item:gt("+n+")").css({background:"green",color:"white"}),at(t,t.counter)}}),p.sub_type?(D.removeAttr("annotation-id"),nt("notes")):(D.attr("annotation-id",f),$("#pdf-annotate-edit-overlay a").remove(),nt("comments")),it()},v=function(){p=!1},$(r).width(),$(r).height(),$(i).height(),$("body").on("click",".toolbar:first .comment",function(){Y.destroyEditOverlay(),a=$(this).is(".personal")?"notes":"comments",b()}),Y.addEventListener("annotation:click",m),Y.addEventListener("annotation:blur",v)}(window,document),N.render=ut}catch(t){console.log(t)}var ct,lt;var ft},function(t,e,n){!function(){if(null==t)var t={};t.txt={}}()},function(e,n,o){var i,a,u;(function(e){"use strict";var o,c=void 0,p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};o=function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={exports:{},id:o,loaded:!1};return t[o].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=t,n.c=e,n.p="",n(0)}([function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o,r=n(1),i=(o=r)&&o.__esModule?o:{default:o};e.default=i.default,t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=s(n(2)),r=s(n(8)),i=s(n(10)),a=s(n(28));function s(t){return t&&t.__esModule?t:{default:t}}e.default={StoreAdapter:o.default,LocalStoreAdapter:r.default,__storeAdapter:new o.default,getStoreAdapter:function(){return this.__storeAdapter},setStoreAdapter:function(t){this.__storeAdapter=t},UI:a.default,render:i.default,getAnnotations:function(t,e){var n;return(n=this.getStoreAdapter()).getAnnotations.apply(n,arguments)}},t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o,r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=n(3),a=(o=i)&&o.__esModule?o:{default:o},s=n(4),u=function(){function t(){var e=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Object.keys(n).forEach(function(t){"function"==typeof n[t]&&"function"==typeof e[t]&&(e[t]=n[t])})}return r(t,[{key:"__getAnnotations",value:function(t,e){(0,a.default)("getAnnotations")}},{key:"getAnnotation",value:function(t,e){(0,a.default)("getAnnotation")}},{key:"getCommentAnnotations",value:function(t){(0,a.default)("getCommentAnnotations")}},{key:"getPointAnnotations",value:function(t,e){(0,a.default)("getPointAnnotations")}},{key:"__addAnnotation",value:function(t,e,n){(0,a.default)("addAnnotation")}},{key:"__editAnnotation",value:function(t,e,n){(0,a.default)("editAnnotation"),destroyEditOverlay()}},{key:"__deleteAnnotation",value:function(t,e){(0,a.default)("deleteAnnotation")}},{key:"getComments",value:function(t,e){(0,a.default)("getComments")}},{key:"getAllComments",value:function(t){(0,a.default)("getAllComments")}},{key:"__addComment",value:function(t,e,n){(0,a.default)("addComment")}},{key:"__editComment",value:function(t,e){(0,a.default)("editComment")}},{key:"__deleteComment",value:function(t,e,n){(0,a.default)("deleteComment")}},{key:"getAnnotations",get:function(){return this.__getAnnotations},set:function(t){this.__getAnnotations=function(e,n){return t.apply(void 0,arguments).then(function(t){return t.annotations&&t.annotations.forEach(function(t){t.documentId=e}),t})}}},{key:"addAnnotation",get:function(){return this.__addAnnotation},set:function(t){this.__addAnnotation=function(e,n,o){return t.apply(void 0,arguments).then(function(t){return(0,s.fireEvent)("annotation:add",e,n,t),t})}}},{key:"editAnnotation",get:function(){return this.__editAnnotation},set:function(t){this.__editAnnotation=function(e,n,o){return t.apply(void 0,arguments).then(function(t){return(0,s.fireEvent)("annotation:edit",e,n,t),t})}}},{key:"deleteAnnotation",get:function(){return this.__deleteAnnotation},set:function(t){this.__deleteAnnotation=function(e,n){return t.apply(void 0,arguments).then(function(t){return t&&(0,s.fireEvent)("annotation:delete",e,n),t})}}},{key:"addComment",get:function(){return this.__addComment},set:function(t){this.__addComment=function(e,n,o){return t.apply(void 0,arguments).then(function(t){return(0,s.fireEvent)("comment:add",e,n,t),t})}}},{key:"editComment",get:function(){return this.__editComment},set:function(t){this.__editComment=function(e,n){return t.apply(void 0,arguments).then(function(t){return t&&(0,s.fireEvent)("comment:edit",e,n),t})}}},{key:"deleteComment",get:function(){return this.__deleteComment},set:function(t){this.__deleteComment=function(e,n,o){return t.apply(void 0,arguments).then(function(t){return t&&(0,s.fireEvent)("comment:delete",e,n,o),t})}}}]),t}();e.default=u,t.exports=e.default},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){throw new Error(t+" is not implemented")},t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.fireEvent=function(){s.emit.apply(s,arguments)},e.addEventListener=function(){s.on.apply(s,arguments)},e.removeEventListener=function(){s.removeListener.apply(s,arguments)};var o,r=n(5),i=(o=r)&&o.__esModule?o:{default:o},a=n(6),s=new i.default,u=void 0;document.addEventListener("click",function(t){if($(".toolbar .cursor").hasClass("active")&&(0,a.findSVGAtPoint)(t.clientX,t.clientY)){var e=(0,a.findAnnotationAtPoint)(t.clientX,t.clientY);u&&u!==e&&s.emit("annotation:blur",u),e&&(s.emit("annotation:click",e),u=e)}})},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(t){return"function"==typeof t}function r(t){return"object"===(void 0===t?"undefined":p(t))&&null!==t}function i(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,a,s,u,d;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(i(n=this._events[t]))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(r(n))for(s=Array.prototype.slice.call(arguments,1),a=(d=n.slice()).length,u=0;u<a;u++)d[u].apply(this,s);return!0},n.prototype.addListener=function(t,e){var a;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned&&(a=i(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[t].length>a&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!o(e))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(t,r),n||(n=!0,e.apply(this,arguments))}return r.listener=e,this.on(t,r),this},n.prototype.removeListener=function(t,e){var n,i,a,s;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(a=(n=this._events[t]).length,i=-1,n===e||o(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(n)){for(s=a;s-- >0;)if(n[s]===e||n[s].listener&&n[s].listener===e){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(o(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.BORDER_COLOR=void 0,e.findSVGContainer=function(t){for(var e=t;(e=e.parentNode)&&e!==document;)if("SVG"===e.nodeName.toUpperCase()&&"true"===e.getAttribute("data-pdf-annotate-container"))return e;return null},e.findSVGAtPoint=s,e.findAnnotationAtPoint=function(t,e){var n=s(t,e);if(n){for(var o=n.querySelectorAll("[data-pdf-annotate-type]"),r=0,i=o.length;r<i;r++){var a=o[r];if(u(t,e,d(a)))return a}return null}},e.pointIntersectsRect=u,e.getOffsetAnnotationRect=d,e.getAnnotationRect=c,e.scaleUp=l,e.scaleDown=function(t,e){var n={},o=p(t).viewport;return Object.keys(e).forEach(function(t){n[t]=e[t]/o.scale}),n},e.getScroll=function(t){for(var e=0,n=0,o=t;(o=o.parentNode)&&o!==document;)e+=o.scrollTop,n+=o.scrollLeft;return{scrollTop:e,scrollLeft:n}},e.getOffset=f,e.disableUserSelect=function(){a.parentNode||document.head.appendChild(a)},e.enableUserSelect=function(){a.parentNode&&a.parentNode.removeChild(a)},e.getMetadata=p;var o,r=n(7),i=(o=r)&&o.__esModule?o:{default:o};e.BORDER_COLOR="#00BFFF";var a=(0,i.default)({body:{"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}});function s(t,e){for(var n=document.querySelectorAll('svg[data-pdf-annotate-container="true"]'),o=0,r=n.length;o<r;o++){var i=n[o];if(u(t,e,i.getBoundingClientRect()))return i}return null}function u(t,e,n){return e>=n.top&&e<=n.bottom&&t>=n.left&&t<=n.right}function d(t){var e=c(t),n=f(t),o=n.offsetLeft,r=n.offsetTop;return{top:e.top+r,left:e.left+o,right:e.right+o,bottom:e.bottom+r}}function c(t){var e=0,n=0,o=0,r=0,i=t.getBoundingClientRect();switch(t.nodeName.toLowerCase()){case"path":var a=void 0,u=void 0,d=void 0,c=void 0;t.getAttribute("d").replace(/Z/,"").split("M").splice(1).forEach(function(t){var e=t.split(" ").map(function(t){return parseInt(t,10)});(void 0===a||e[0]<a)&&(a=e[0]),(void 0===u||e[2]>u)&&(u=e[2]),(void 0===d||e[1]<d)&&(d=e[1]),(void 0===c||e[3]>c)&&(c=e[3])}),e=c-d,n=u-a,o=a,r=d;break;case"line":e=parseInt(t.getAttribute("y2"),10)-parseInt(t.getAttribute("y1"),10),n=parseInt(t.getAttribute("x2"),10)-parseInt(t.getAttribute("x1"),10),o=parseInt(t.getAttribute("x1"),10),r=parseInt(t.getAttribute("y1"),10),0===e&&(e+=16,r-=8);break;case"text":e=i.height,n=i.width,o=parseInt(t.getAttribute("x"),10),r=parseInt(t.getAttribute("y"),10)-e;break;case"g":var p=f(t),v=p.offsetLeft,m=p.offsetTop;e=i.height,n=i.width,o=i.left-v,r=i.top-m,"strikeout"===t.getAttribute("data-pdf-annotate-type")?(e+=16,r-=8):"underline"===t.getAttribute("data-pdf-annotate-type")&&(e+=16,r-=14);break;case"rect":case"svg":e=parseInt(t.getAttribute("height"),10),n=parseInt(t.getAttribute("width"),10),o=parseInt(t.getAttribute("x"),10),r=parseInt(t.getAttribute("y"),10)}var h={top:r,left:o,width:n,height:e,right:o+n,bottom:r+e};return["svg","g"].includes(t.nodeName.toLowerCase())||(h=l(s(i.left,i.top),h)),h}function l(t,e){var n={},o=p(t).viewport;return Object.keys(e).forEach(function(t){n[t]=e[t]*o.scale}),n}function f(t){for(var e=t;(e=e.parentNode)&&e!==document&&"SVG"!==e.nodeName.toUpperCase(););var n=e.getBoundingClientRect();return{offsetLeft:n.left,offsetTop:n.top}}function p(t){return{documentId:t.getAttribute("data-pdf-annotate-document"),pageNumber:parseInt(t.getAttribute("data-pdf-annotate-page"),10),viewport:JSON.parse(t.getAttribute("data-pdf-annotate-viewport"))}}a.setAttribute("data-pdf-annotate-user-select","true")},function(t,e){t.exports=function(t){var e=document.createElement("style"),n=Object.keys(t).map(function(e){return function(t,e){return t+" {\n"+function(t){return Object.keys(t).map(function(e){return function(t,e){return isNaN(e)||0==e||(e+="px"),function(t){return t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})}(t)+": "+e+";"}(e,t[e])}).join("\n")}(e)+"\n}"}(e,t[e])}).join("\n");return e.setAttribute("type","text/css"),e.appendChild(document.createTextNode(n)),e}},function(e,n,o){Object.defineProperty(n,"__esModule",{value:!0});var i=s(o(9)),a=s(o(2));function s(t){return t&&t.__esModule?t:{default:t}}var u=function(e){function n(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":p(e))&&"function"!=typeof e?t:e}(this,Object.getPrototypeOf(n).call(this,{getAnnotations:function(e,n){return new Promise(function(o,r){var i=c(e).filter(function(e){return e.page===n&&"Annotation"===e.class&&(e.uid==t.id||"point"==e.type&&!e.sub_type)});o({documentId:e,pageNumber:n,annotations:i})})},getCommentAnnotations:function(e,n){return new Promise(function(n,o){var r=c(e).filter(function(e){return"point"==e.type&&"Annotation"===e.class&&(e.uid==t.id||!e.sub_type)});n({documentId:e,annotations:r})})},getPointAnnotations:function(e,n){return new Promise(function(o,r){var i=c(e).filter(function(e){return n?"point"==e.type&&"Annotation"===e.class&&e.uid==t.id&&e.sub_type:"point"==e.type&&"Annotation"===e.class&&!e.sub_type});o({documentId:e,annotations:i})})},getCommentPoints:function(t){return this.getCommentAnnotations(t)},getNotePoints:function(t){return this.getCommentAnnotations(t,sub_type)},getAnnotation:function(t,e){return Promise.resolve(c(t)[v(t,e)])},addAnnotation:function(e,n,o){return new Promise(function(a,s){if("string"==typeof o.type)if(t.id)if(o.class="Annotation",o.uuid=(0,i.default)(),o.page=n,o.date_time=new Date,t.id){o.uid=t.id;var u=c(e);u.push(o),"drawing"==o.type&&(o.to_merge=1,r.push(o));var d="pooint"==o.type&&!o.sub_type;f(e,u,d),a(o)}else console.log("oops no user id");else bootbox.alert("No user Id given");else console.log("Invalid annotation",o)})},editAnnotation:function(t,e,n){return new Promise(function(o,r){var i=c(t);i[v(t,e)]=n,f(t,i),function(t,e,n){document.querySelectorAll('[data-pdf-annotate-id="'+t+'"]').forEach(function(t){var o=!1;switch(e){case"strikeout":case"underline":o="stroke";break;case"highlight":o="fill";break;case"drawing":-1==n.indexOf("#")&&(n="#"+n),$(t).attr("stroke",n),o="fill"}o&&$(t).attr(o,"#"+n)})}(e,n.type,n.color),o(n)})},deleteAnnotation:function(t,e){return new Promise(function(n,o){var r=v(t,e);if(r>-1){var i=c(t);i.splice(r,1),f(t,i)}n(!0)})},getComments:function(t,e){return new Promise(function(n,o){var r=c(t).filter(function(t){return t.uuid===e}),i=[];i=Array.isArray(r)&&r.length>0?r[0].comments:[],Array.isArray(i)||(i=[]),n(i)})},getAllComments:function(t){return new Promise(function(e,n){e(c(t).filter(function(t){return"point"===t.type}).sort(function(t,e){return t.page-e.page||t.y-e.y||t.x-e.x})||[])})},addComment:function(t,e,n,o){return new Promise(function(r,a){if(e){var s={class:"Comment",uuid:(0,i.default)(),point_id:e,content:n.content,uid:n.uid,user_name:n.user_name,date_time:n.date_time},u=t.split("-"),l={doc_type:u[0],document_id:u[1],comment_doc_name:d};console.log(l);var p=c(t),v={},m=-1;for(var h in p)if(p[h].uuid==e){m=h;var g=p[h];for(var b in g)"comments"!=b&&(v[b]=g[b]);break}if(m>-1){p[m].comments?p[m].comments.push(s):p[m].comments=[s],v.comment=s,v.doc_id=t,v.document_id=u[1],v.comment_doc_id=d,l.point=v,l.mentioned_list=y;var _="personal"!=v.sub_type;_&&!o&&(dn_rpc_object({data:{args:{app:"documents",model:"CommentAnnotation",method:"save_comment"},params:l},no_loader:1,onSuccess:function(t){y=[],console.log("comment saved")}}),setTimeout(function(){$(".comment-list-container:first").scrollTop(9999)},10)),f(t,p,_)}else console.log("Annotation not found "+e)}else console.log("Comment not added because, no active annotationId");r(s)})},editComment:function(t,e,n,o){return new Promise(function(r,i){for(var a=c(t),s=0;s<a.length;s++)n===a[s].annotation&&e===a[s].uuid&&(a[s].content=o);f(t,a,1),r(!0)})},deleteComment:function(t,e,n){return new Promise(function(e,o){c(t);for(var r=-1,i=c(t),a=0,s=i.length;a<s;a++)if(i[a].uuid===n){r=a;break}r>-1&&(i.splice(r,1),f(t,i,1)),e(!0)})}}))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":p(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,a.default),n}();function c(t){var e=P(t,t+"/annotations");return e=e?JSON.parse(e):[]}n.default=u;var l=void 0;function f(t,e,n){var o="";Array.isArray(e)&&(o=JSON.stringify(e)),I(t,t+"/annotations",o),n||(E(t),clearTimeout(l),l=setTimeout(function(){_()},3e4))}function v(t,e){for(var n=-1,o=c(t),r=0,i=o.length;r<i;r++)if(o[r].uuid===e){n=r;break}return n}e.exports=n.default},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return o.replace(n,r)};var n=/[xy]/g,o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";function r(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){return new Promise(function(r,i){return t.innerHTML="",t.setAttribute("data-pdf-annotate-container",!0),t.setAttribute("data-pdf-annotate-viewport",JSON.stringify(e)),t.removeAttribute("data-pdf-annotate-document"),t.removeAttribute("data-pdf-annotate-page"),n?(t.setAttribute("data-pdf-annotate-document",n.documentId),t.setAttribute("data-pdf-annotate-page",n.pageNumber),Array.isArray(n.annotations)&&0!==n.annotations.length?(n.annotations.forEach(function(n){(0,o.default)(t,n,e)}),void r(t)):r(t)):r(t)})},r(n(1));var o=r(n(11));function r(t){return t&&t.__esModule?t:{default:t}}r(n(20)),t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){n||(n=JSON.parse(t.getAttribute("data-pdf-annotate-viewport")));var u=void 0;switch(e.type){case"area":case"highlight":u=(0,a.default)(e);break;case"strikeout":case"underline":u=(0,o.default)(e);break;case"point":u=(0,i.default)(e);break;case"textbox":u=(0,s.default)(e);break;case"drawing":u=(0,r.default)(e)}return u&&(u.setAttribute("data-pdf-annotate-id",e.uuid),u.setAttribute("data-pdf-annotate-type",e.type),u.setAttribute("aria-hidden",!0),t.appendChild(function(t,e){var n=function(t){var e=void 0,n=void 0,o=t.rotation%360;switch(o<0&&(o+=360),o){case 0:e=n=0;break;case 90:e=0,n=t.width/t.scale*-1;break;case 180:e=t.width/t.scale*-1,n=t.height/t.scale*-1;break;case 270:e=t.height/t.scale*-1,n=0}return{x:e,y:n}}(e),o="scale("+e.scale+")";if(o+=" rotate("+e.rotation+")",o+=" translate("+n.x+", "+n.y+")",t.setAttribute("transform",o),!d&&"svg"===t.nodeName.toLowerCase()){t.setAttribute("x",parseInt(t.getAttribute("x"),10)*e.scale),t.setAttribute("y",parseInt(t.getAttribute("y"),10)*e.scale);var r=parseInt(t.getAttribute("x",10)),i=parseInt(t.getAttribute("y",10)),a=parseInt(t.getAttribute("width"),10),s=parseInt(t.getAttribute("height"),10),u=(t.querySelector("path"),[t]),c=t.querySelector("svg"),l=t.querySelector("path"),f=t.querySelector("rect"),p=t.querySelector("g");c&&u.push(c),l&&u.push(l),f&&u.push(f),p&&u.push(p);var v=e.rotation%360;switch(v<0&&(v+=360),v){case 90:t.setAttribute("x",e.width-i-a),t.setAttribute("y",r),c&&(c.setAttribute("x",1),c.setAttribute("y",0));break;case 180:t.setAttribute("x",e.width-r-a),t.setAttribute("y",e.height-i-s),c&&c.setAttribute("y",2);break;case 270:t.setAttribute("x",i),t.setAttribute("y",e.height-r-s),c&&(c.setAttribute("x",-1),c.setAttribute("y",0))}}return t}(u,n))),u},u(n(12));var o=u(n(13)),r=u(n(16)),i=u(n(17)),a=u(n(18)),s=u(n(19));function u(t){return t&&t.__esModule?t:{default:t}}var d=/firefox/i.test(navigator.userAgent);t.exports=e.default},function(t,e){var n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;t.exports=Object.assign||function(t,e){for(var r,i,a=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),s=1;s<arguments.length;s++){for(var u in r=Object(arguments[s]))n.call(r,u)&&(a[u]=r[u]);if(Object.getOwnPropertySymbols){i=Object.getOwnPropertySymbols(r);for(var d=0;d<i.length;d++)o.call(r,i[d])&&(a[i[d]]=r[i[d]])}}return a}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");return(0,o.default)(e,{stroke:(0,r.default)(t.color||"#f00"),strokeWidth:1}),t.rectangles.forEach(function(t){var n=document.createElementNS("http://www.w3.org/2000/svg","line");(0,o.default)(n,{x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y}),e.appendChild(n)}),e};var o=i(n(14)),r=i(n(15));function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){Object.keys(e).forEach(function(n){t.setAttribute(r(n),e[n])})};var n=/[A-Z]/g,o=["viewBox"],r=function(t){return-1===o.indexOf(t)&&(t=t.replace(n,function(t){return"-"+t.toLowerCase()})),t};t.exports=e.default},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return n.test(t)&&(t="#"+t),t};var n=/^([a-f0-9]{6}|[a-f0-9]{3})$/i;t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e=[],n=document.createElementNS("http://www.w3.org/2000/svg","path"),i=0,a=t.lines.length;i<a;i++){var s=t.lines[i],u=t.lines[i+1];s&&3!=s.length&&u&&3!=u.length&&e.push("M"+s[0]+" "+s[1]+" "+u[0]+" "+u[1])}return(0,o.default)(n,{d:e.join(" ")+"Z",stroke:(0,r.default)(t.color||"#000"),strokeWidth:t.width||1,fill:"none"}),n};var o=i(n(14)),r=i(n(15));function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElementNS("http://www.w3.org/2000/svg","path");return(0,i.default)(n,{width:a,height:a,x:0,y:.05*a*-1,viewBox:"0 0 1000 1000"}),(0,i.default)(o,{width:a,height:a,stroke:"#fff",fill:"#ff5"}),(0,i.default)(r,{d:s,strokeWidth:50,stroke:"#000",fill:"#fff"}),t.sub_type&&(0,i.default)(e,{width:28,height:25,x:t.x,y:t.y}),t.sub_type?e.innerHTML='<rect width="25" height="22" x="1.962286" y="1" style="fill:#ffff00;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1;stroke-opacity:1" /> <rect width="18.4" height="1.5012145" x="5.8" y="5" style="fill:#000000;fill-opacity:1;stroke:none" /> <rect width="18" height="0.86" x="6" y="10" style="fill:#000000;fill-opacity:1;stroke:none" /> <rect width="18.4" height="0.86" x="5.8" y="14" style="fill:#000000;fill-opacity:1;stroke:none" /> <rect width="18" height="0.86" x="6" y="18" style="fill:#000000;fill-opacity:1;stroke:none" />':((0,i.default)(e,{width:a,height:a,x:t.x,y:t.y}),n.appendChild(r),e.appendChild(o),e.appendChild(n)),e};var o,r=n(14),i=(o=r)&&o.__esModule?o:{default:o},a=25,s="M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z";t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===p(Symbol.iterator)?function(t){return void 0===t?"undefined":p(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":void 0===t?"undefined":p(t)};e.default=function(t){if("highlight"!==t.type){var e=s(t);return(0,r.default)(e,{stroke:(0,i.default)(t.color||"#f00"),fill:"none"}),e}var n,a=(n=document.createElementNS("http://www.w3.org/2000/svg","g"),(0,r.default)(n,{fill:(0,i.default)(t.color||"#ff0"),fillOpacity:.2}),t.rectangles.forEach(function(t){n.appendChild(s(t))}),{v:n});if("object"===(void 0===a?"undefined":o(a)))return a.v};var r=a(n(14)),i=a(n(15));function a(t){return t&&t.__esModule?t:{default:t}}function s(t){var e=document.createElementNS("http://www.w3.org/2000/svg","rect");return(0,r.default)(e,{x:t.x,y:t.y,width:t.width,height:t.height}),e}t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","text");return(0,o.default)(e,{x:t.x,y:t.y+parseInt(t.size,10),fill:(0,r.default)(t.color||"#000"),fontSize:t.size}),e.innerHTML=t.content,e};var o=i(n(14)),r=i(n(15));function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){t=Array.isArray(t)?t:[],Object.keys(s).forEach(function(e){var n=s[e];t.filter(function(t){return t.type===e}).sort(n).forEach(function(t,e){return(0,o.default)(t,e+1)})})};var o=r(n(21));function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){return t.y<e.y?t.x-e.x:1}function a(t,e){return i(t.rectangles[0],e.rectangles[0])}(0,r(n(27)).default)();var s={highlight:a,strikeout:a,underline:a,drawing:function(t,e){var n=t.lines[0],o=e.lines[0];return i({x:n[0],y:n[1]},{x:o[0],y:o[1]})},textbox:i,point:i,area:i};t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=arguments.length<=1||void 0===arguments[1]?0:arguments[1];switch(t.type){case"highlight":case"strikeout":case"underline":var n=t.rectangles,a=n[0],s=n[n.length-1];c=(0,o.default)("Begin "+t.type+" annotation "+e,t.uuid),(0,i.default)(c,a.x,a.y,t.page,!0),c=(0,o.default)("End "+t.type+" annotation "+e,t.uuid+"-end"),(0,i.default)(c,s.x+s.width,s.y,t.page,!1);break;case"textbox":case"point":var u="textbox"===t.type?" (content: "+t.content+")":"";c=(0,o.default)(t.type+" annotation "+e+u,t.uuid),(0,r.default)(c,t.x,t.y,t.page);break;case"drawing":case"area":var d=void 0!==t.x?t.x:t.lines[0][0],l=void 0!==t.y?t.y:t.lines[0][1];c=(0,o.default)("Unlabeled drawing",t.uuid),(0,r.default)(c,d,l,t.page)}};var o=a(n(22)),r=a(n(23)),i=a(n(24));function a(t){return t&&t.__esModule?t:{default:t}}a(n(25)),t.exports=e.default},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var n=document.createElement("div"),o=document.createTextNode(t);return n.appendChild(o),n.setAttribute("id","pdf-annotate-screenreader-"+e),n.style.position="absolute",n.style.left="-10000px",n.style.top="auto",n.style.width="1px",n.style.height="1px",n.style.overflow="hidden",n},t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,o){if((0,i.default)(t,e,n,o,!0))return!0;var r=document.querySelector('svg[data-pdf-annotate-page="'+o+'"]'),s=r.getBoundingClientRect(),u=[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(r.parentNode.querySelectorAll(".textLayer > div")));n=(0,a.scaleUp)(r,{y:n}).y+s.top,e=(0,a.scaleUp)(r,{x:e}).x+s.left;for(var d=0,c=u.length;d<c;d++){var l=u[d],f=l.getBoundingClientRect();if(n<=f.top)return l.parentNode.insertBefore(t,l),!0}var p=r.parentNode.querySelector(".textLayer");if(p){var v=p.getBoundingClientRect();if((0,a.pointIntersectsRect)(e,n,v))return p.appendChild(t),!0}return!1};var o,r=n(24),i=(o=r)&&o.__esModule?o:{default:o},a=n(6);t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,r,i){var a=function(t,e,n){var r=document.querySelector('svg[data-pdf-annotate-page="'+n+'"]'),i=r.getBoundingClientRect();return e=(0,o.scaleUp)(r,{y:e}).y+i.top,t=(0,o.scaleUp)(r,{x:t}).x+i.left,[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(r.parentNode.querySelectorAll(".textLayer [data-canvas-width]"))).filter(function(n){return(0,o.pointIntersectsRect)(t,e,n.getBoundingClientRect())})[0]}(e=Math.max(e+2*(i?1:-1),0),n+2,r);if(!a)return!1;e+=2*(i?-1:1);var s=document.querySelector('svg[data-pdf-annotate-page="'+r+'"]'),u=(0,o.scaleDown)(s,{left:a.getBoundingClientRect().left}).left-s.getBoundingClientRect().left,d=a.cloneNode(!0),c=d.innerHTML.split(""),l=[];for(d.style.position="absolute",d.style.top="-10000px",d.style.left="-10000px",document.body.appendChild(d);c.length;){if(">"===c[c.length-1])for(;c.length&&(l.unshift(c.pop()),"<"!==l[0]););d.innerHTML=c.join("");var f=(0,o.scaleDown)(s,{width:d.getBoundingClientRect().width}).width;if(u+f<=e)break;l.unshift(c.pop())}return a.innerHTML=c.join("")+t.outerHTML+l.join(""),d.parentNode.removeChild(d),!0};var o=n(6);t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){return(Array.isArray(n)?Promise.resolve(n):o.default.getStoreAdapter().getComments(t,e)).then(function(t){var n=document.getElementById("pdf-annotate-screenreader-"+e);if(n){var o=document.createElement("ol");o.setAttribute("id","pdf-annotate-screenreader-comment-list-"+e),o.setAttribute("aria-label","Comments"),n.appendChild(o),t.forEach(r.default)}})};var o=i(n(1)),r=i(n(26));function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if(t){var e=document.querySelector("#pdf-annotate-screenreader-"+t.annotation+" ol");if(e){var n=document.createElement("li");n.setAttribute("id","pdf-annotate-screenreader-comment-"+t.uuid),n.appendChild(document.createTextNode(""+t.content)),e.appendChild(n)}}},t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){(0,a.addEventListener)("annotation:add",function(t,e,n){d(t,e,n.type)}),(0,a.addEventListener)("annotation:edit",function(t,e,n){d(t,n.page,n.type)}),(0,a.addEventListener)("annotation:delete",c),(0,a.addEventListener)("comment:add",l),(0,a.addEventListener)("comment:delete",f)},u(n(21));var o=u(n(20)),r=u(n(26)),i=u(n(25)),a=n(4),s=u(n(1));function u(t){return t&&t.__esModule?t:{default:t}}function d(t,e,n){s.default.getStoreAdapter().getAnnotations(t,e).then(function(t){return t.annotations.filter(function(t){return t.type===n})}).then(function(t){return t.forEach(function(t){c(0,t.uuid)}),t}).then(o.default)}function c(t,e){p("pdf-annotate-screenreader-"+e),p("pdf-annotate-screenreader-"+e+"-end")}function l(t,e,n){var o=document.querySelector("pdf-annotate-screenreader-comment-list-"+e);(o?Promise.resolve(!0):(0,i.default)(t,e,[]).then(function(){return o=document.querySelector("pdf-annotate-screenreader-comment-list-"+e),!0})).then(function(){(0,r.default)(n)})}function f(t,e){p("pdf-annotate-screenreader-comment-"+e)}function p(t){var e=document.getElementById(t);e&&e.parentNode.removeChild(e)}t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),r=n(29),i=n(30),a=n(31),s=n(32),u=n(33),d=n(34);e.default={addEventListener:o.addEventListener,removeEventListener:o.removeEventListener,fireEvent:o.fireEvent,disableEdit:r.disableEdit,enableEdit:r.enableEdit,destroyEditOverlay:r.destroyEditOverlay,disablePen:i.disablePen,enablePen:i.enablePen,setPen:i.setPen,disablePoint:a.disablePoint,enablePoint:a.enablePoint,disableRect:s.disableRect,enableRect:s.enableRect,disableText:u.disableText,enableText:u.enableText,setText:u.setText,createPage:d.createPage,renderPage:d.renderPage,renderPageWithoutAnnotations:d.renderPageWithoutAnnotations},t.exports=e.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{!o&&s.return&&s.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};e.enableEdit=function(t){c||(t?w(t):(c=!0,(0,a.addEventListener)("annotation:click",m)))},e.disableEdit=function(){x(),c&&(c=!1,(0,a.removeEventListener)("annotation:click",m))},e.destroyEditOverlay=x;var r=u(n(1)),i=u(n(11)),a=n(4),s=n(6);function u(t){return t&&t.__esModule?t:{default:t}}function d(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var c=!1,l=!1,p=void 0,v=void 0,y=void 0,g=void 0,b=void 0,_=3;function w(t){x(),p=document.createElement("div");var e=document.createElement("a"),n=(0,s.findSVGContainer)(t).parentNode,o=t.getAttribute("data-pdf-annotate-id"),r=(0,s.getAnnotationRect)(t),i=r.left-_,a=r.top-_;p.setAttribute("id","pdf-annotate-edit-overlay"),p.setAttribute("data-target-id",o),p.style.boxSizing="content-box",p.style.position="absolute",p.style.top=a+"px",p.style.left=i+"px",p.style.width=r.width+"px",p.style.height=r.height+"px",p.style.border=_+"px solid "+s.BORDER_COLOR,p.style.borderRadius=_+"px",e.innerHTML="×",e.setAttribute("href","javascript://"),e.style.background="#fff",e.style.borderRadius="20px",e.style.border="1px solid #bbb",e.style.color="#bbb",e.style.fontSize="16px",e.style.padding="2px",e.style.textAlign="center",e.style.textDecoration="none",e.style.position="absolute",e.style.top="-13px",e.style.right="-13px",e.style.width="25px",e.style.height="25px",p.appendChild(e),n.appendChild(p),document.addEventListener("click",S),document.addEventListener("keyup",C),document.addEventListener("mousedown",k),e.addEventListener("click",A),e.addEventListener("mouseover",function(){e.style.color="#35A4DC",e.style.borderColor="#999",e.style.boxShadow="0 1px 1px #ccc"}),e.addEventListener("mouseout",function(){e.style.color="#bbb",e.style.borderColor="#bbb",e.style.boxShadow=""}),p.addEventListener("mouseover",function(){l||(e.style.display="")}),p.addEventListener("mouseout",function(){e.style.display="none"})}function x(){p&&(p.parentNode.removeChild(p),p=null),document.removeEventListener("click",S),document.removeEventListener("keyup",C),document.removeEventListener("mousedown",k),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",P),(0,s.enableUserSelect)()}function A(){if(p){var t=p.getAttribute("data-target-id"),e=document.querySelectorAll('[data-pdf-annotate-id="'+t+'"]'),n=p.parentNode.querySelector("svg.annotationLayer"),o=(0,s.getMetadata)(n).documentId,i=localStorage.getItem(o+"/annotations");if(i){var a=JSON.parse(i).filter(function(e){return e.uuid==t});if(a.length>0&&"point"==a[0].type&&!a[0].sub_type)return}[].concat(d(e)).forEach(function(t){t.parentNode.removeChild(t)}),r.default.getStoreAdapter().deleteAnnotation(o,t),x()}}function S(t){if((0,s.findSVGAtPoint)(t.clientX,t.clientY)){var e=document.getElementById("pdf-annotate-edit-overlay");if(e){if(l||t.target===e)return;x()}}}function C(t){p&&46===t.keyCode&&"textarea"!==t.target.nodeName.toLowerCase()&&"input"!==t.target.nodeName.toLowerCase()&&A()}var E=void 0;function k(t){if(t.target===p){var e=p.getAttribute("data-target-id"),n=document.querySelector('[data-pdf-annotate-id="'+e+'"]').getAttribute("data-pdf-annotate-type");if("highlight"!==n&&"strikeout"!==n&&"underline"!==n){l=!0,v=t.clientX,y=t.clientY,g=p.offsetLeft,b=p.offsetTop,p.style.background="rgba(255, 255, 255, 0.7)",p.style.cursor="move";var o=p.querySelector("a");o&&o.style&&(o.style.display="none"),document.addEventListener("mousemove",L),document.addEventListener("mouseup",P),(0,s.disableUserSelect)(),E=0!=(E=$('.new_comments_count[point_id="'+e+'"]')).length&&E[0]}}}function L(t){p.getAttribute("data-target-id");var e=p.parentNode.getBoundingClientRect(),n=b+(t.clientY-y),o=g+(t.clientX-v),r=e.height,i=e.width;n>0&&n+p.offsetHeight<r&&(p.style.top=n+"px",E&&(E.style.top=n-15+"px")),o>0&&o+p.offsetWidth<i&&(p.style.left=o+"px",E&&(E.style.left=o+20+"px"))}function P(t){var e=p.getAttribute("data-target-id"),n=document.querySelectorAll('[data-pdf-annotate-id="'+e+'"]'),a=n[0].getAttribute("data-pdf-annotate-type"),u=p.parentNode.querySelector("svg.annotationLayer"),c=(0,s.getMetadata)(u).documentId,f=p.querySelector("a");function v(t,e){return{deltaX:_+(0,s.scaleDown)(u,{x:p.offsetLeft}).x-t,deltaY:_+(0,s.scaleDown)(u,{y:p.offsetTop}).y-e}}f&&f.style&&(f.style.display=""),r.default.getStoreAdapter().getAnnotation(c,e).then(function(t){var l,f,p,m,h;["area","highlight","point","textbox"].indexOf(a)>-1?(l="x",f="y",p=v(parseInt(n[0].getAttribute(l),10),parseInt(n[0].getAttribute(f),10)),m=p.deltaX,h=p.deltaY,[].concat(d(n)).forEach(function(e,n){if(0!==h){var o=parseInt(e.getAttribute("y"),10)+h,r=o;"textbox"===a&&(r+=t.size),"point"===a&&(r=(0,s.scaleUp)(u,{viewY:r}).viewY),e.setAttribute("y",r),t.rectangles?t.rectangles[n].y=o:t.y&&(t.y=o)}if(0!==m){var i=parseInt(e.getAttribute("x"),10)+m,d=i;"point"===a&&(d=(0,s.scaleUp)(u,{viewX:d}).viewX),e.setAttribute("x",d),t.rectangles?t.rectangles[n].x=i:t.x&&(t.x=i)}})):"drawing"===a&&function(){var e=(0,s.scaleDown)(u,(0,s.getAnnotationRect)(n[0])),r=o(t.lines[0],2),a=r[0],d=r[1],c=v(a,d),l=c.deltaX,f=c.deltaY;f+=d-e.top,l+=a-e.left,t.lines.forEach(function(e,n){var r=o(t.lines[n],2),i=r[0],a=r[1];t.lines[n][0]=i+l,t.lines[n][1]=a+f}),n[0].parentNode.removeChild(n[0]),(0,i.default)(u,t)}(),r.default.getStoreAdapter().editAnnotation(c,e,t)}),setTimeout(function(){l=!1},0),p.style.background="",p.style.cursor="",document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",P),(0,s.enableUserSelect)()}m=function(t){setTimeout(function(){f=t.getAttribute("data-pdf-annotate-id"),w(t),h(t)},15)}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.setPen=function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],e=arguments.length<=1||void 0===arguments[1]?"000000":arguments[1];u=parseInt(t,10),d=e},e.enablePen=function(){s||(is_mobile_device&&$("body").css("overflow","hidden"),s=!0,document.addEventListener("mousedown",f),document.addEventListener("touchstart",f),(0,i.disableUserSelect)())},e.disablePen=function(){s&&(s=!1,document.removeEventListener("mousedown",f),document.removeEventListener("touchstart",f),(0,i.enableUserSelect)())};var o=a(n(1)),r=a(n(11)),i=n(6);function a(t){return t&&t.__esModule?t:{default:t}}var s=!1,u=void 0,d=void 0,c=void 0,l=void 0;function f(t){is_mobile_device&&$("body").css("overflow","hidden"),c=null,l=[],document.addEventListener("mousemove",v),document.addEventListener("mouseup",p),document.addEventListener("touchmove",v,{passive:!1}),document.addEventListener("touchend",p)}function p(t){t.changedTouches&&(t=t.changedTouches[0]);var e=void 0;if(l.length>1&&(e=(0,i.findSVGAtPoint)(t.clientX,t.clientY))){var n=(0,i.getMetadata)(e),a=n.documentId,s=n.pageNumber;l[l.length-1].push(-1),o.default.getStoreAdapter().addAnnotation(a,s,{type:"drawing",width:u,color:d,lines:l}).then(function(t){c&&e.removeChild(c),(0,r.default)(e,t)})}document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",p),document.removeEventListener("touchmove",v),document.removeEventListener("touchend",p),is_mobile_device&&$("body").css("overflow","auto")}function v(t){t.preventDefault(),t.touches&&(t=t.touches[0]),function(t,e){var n=(0,i.findSVGAtPoint)(t,e);if(n){var o=n.getBoundingClientRect(),a=(0,i.scaleDown)(n,{x:t-o.left,y:e-o.top});l.push([a.x,a.y]),l.length<=1||(c&&n.removeChild(c),c=(0,r.default)(n,{type:"drawing",color:d,width:u,lines:l}))}}(t.clientX,t.clientY)}},function(e,n,o){Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"===p(Symbol.iterator)?function(t){return void 0===t?"undefined":p(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":void 0===t?"undefined":p(t)};n.enablePoint=function(){c||(c=!0,document.addEventListener("mouseup",v))},n.disablePoint=function(){c&&(c=!1,document.removeEventListener("mouseup",v))};var i=d(o(1)),a=d(o(11)),u=o(6);function d(t){return t&&t.__esModule?t:{default:t}}var c=!1,f=void 0;function v(t){!f&&(0,u.findSVGAtPoint)(t.clientX,t.clientY)&&((f=document.createElement("input")).setAttribute("id","pdf-annotate-point-input"),f.setAttribute("placeholder","Enter comment"),f.style.border="3px solid "+u.BORDER_COLOR,f.style.borderRadius="3px",f.style.position="fixed",f.style.top=t.clientY+"px",f.style.left=t.clientX+"px",f.addEventListener("blur",m),f.addEventListener("keyup",h),document.body.appendChild(f),f.focus())}function m(){y()}function h(t){27===t.keyCode?g():13===t.keyCode&&y()}function y(){if(0!=f.value.trim().length){if(f.value.trim().length>0){var e=function(){var e=parseInt(f.style.left,10),n=parseInt(f.style.top,10),o=f.value.trim(),r=(0,u.findSVGAtPoint)(e,n);if(!r)return{v:void 0};var d=r.getBoundingClientRect(),c=(0,u.getMetadata)(r),p=c.documentId,v=c.pageNumber,m=Object.assign({type:"point"},(0,u.scaleDown)(r,{x:e-d.left,y:n-d.top})),h=i.default.getStoreAdapter();m.sub_type=s,m.counter=0,h.addAnnotation(p,v,m).then(function(e){var n={content:o,date_time:new Date,uid:t.id,user_name:t.name};h.addComment(p,e.uuid,n),(0,a.default)(r,e);var i=e.uuid,s=$("select.scale").val(),u="<div point_id="+e.uuid+' class="new_comments_count"';u+=' comment_count="0" style="top:'+(e.y*s-15)+"px;left:"+(e.x*s+15)+'px;;display:none;">0</div>',u=$(u),$("#pageContainer"+v+" .canvasWrapper").append(u),l(i)})}();if("object"===(void 0===e?"undefined":r(e)))return e.v}g()}else g()}function g(){f.removeEventListener("blur",m),f.removeEventListener("keyup",h),document.body.removeChild(f),f=null}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.enableRect=function(t){d=t,u||(u=!0,document.addEventListener("mouseup",y),document.addEventListener("mousedown",p),document.addEventListener("keyup",m),y(t))},e.disableRect=function(){u&&(u=!1,document.removeEventListener("mouseup",y),document.removeEventListener("mousedown",p),document.removeEventListener("keyup",m))};var o=a(n(1)),r=a(n(11)),i=n(6);function a(t){return t&&t.__esModule?t:{default:t}}function s(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var u=!1,d=void 0,c=void 0,l=void 0,f=void 0;function p(t){var e=void 0;if("area"===d&&(e=(0,i.findSVGAtPoint)(t.clientX,t.clientY))){var n=e.getBoundingClientRect();l=t.clientY,f=t.clientX,(c=document.createElement("div")).style.position="absolute",c.style.top=l-n.top+"px",c.style.left=f-n.left+"px",c.style.border="3px solid "+i.BORDER_COLOR,c.style.borderRadius="3px",e.parentNode.appendChild(c),document.addEventListener("mousemove",v),(0,i.disableUserSelect)()}}function v(t){var e=c.parentNode.querySelector("svg.annotationLayer").getBoundingClientRect();f+(t.clientX-f)<e.right&&(c.style.width=t.clientX-f+"px"),l+(t.clientY-l)<e.bottom&&(c.style.height=t.clientY-l+"px")}function m(t){27===t.keyCode&&(window.getSelection().removeAllRanges(),c&&c.parentNode&&(c.parentNode.removeChild(c),c=null,document.removeEventListener("mousemove",v)))}function h(t,e,n){var a=(0,i.findSVGAtPoint)(e[0].left,e[0].top),u=void 0;if(a){var d=a.getBoundingClientRect();if(n||("highlight"===t?n="FFFF00":"strikeout"===t?n="FF0000":"underline"===t&&(n="00FF00")),0!==(u={type:t,color:n,rectangles:[].concat(s(e)).map(function(e){var n=0;return"strikeout"===t?n=e.height/2:"underline"===t&&(n=e.height-2),(0,i.scaleDown)(a,{y:e.top+n-d.top,x:e.left-d.left,width:e.width,height:e.height})}).filter(function(t){return t.width>0&&t.height>0&&t.x>-1&&t.y>-1})}).rectangles.length){if("area"===t){var c=u.rectangles[0];delete u.rectangles,u.x=c.x,u.y=c.y,u.width=c.width,u.height=c.height}var l=(0,i.getMetadata)(a),f=l.documentId,p=l.pageNumber;o.default.getStoreAdapter().addAnnotation(f,p,u).then(function(t){(0,r.default)(a,t)})}}}function y(t){if("string"==typeof t){var e=void 0;if("area"!==(d=t)&&(e=function(){try{var t=window.getSelection().getRangeAt(0).getClientRects();if(t.length>0&&t[0].width>0&&t[0].height>0)return t}catch(t){}return null}())){(0,i.findSVGAtPoint)(e[0].left,e[0].top);var n=s(e),o=(n=[].concat(n)).map(function(t){return{top:t.top,left:t.left,width:t.width,height:t.height}});h(d,o)}else if("area"===d&&c){var r=c.parentNode.querySelector("svg.annotationLayer").getBoundingClientRect();h(d,[{top:parseInt(c.style.top,10)+r.top,left:parseInt(c.style.left,10)+r.left,width:parseInt(c.style.width,10),height:parseInt(c.style.height,10)}]),c.parentNode.removeChild(c),c=null,document.removeEventListener("mousemove",v),(0,i.enableUserSelect)()}}}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===p(Symbol.iterator)?function(t){return void 0===t?"undefined":p(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":void 0===t?"undefined":p(t)};e.setText=function(){var t=arguments.length<=0||void 0===arguments[0]?12:arguments[0],e=arguments.length<=1||void 0===arguments[1]?"000000":arguments[1];c=parseInt(t,10),l=e},e.enableText=function(){u||(u=!0,document.addEventListener("mouseup",f))},e.disableText=function(){u&&(u=!1,document.removeEventListener("mouseup",f))};var r=s(n(1)),i=s(n(11)),a=n(6);function s(t){return t&&t.__esModule?t:{default:t}}var u=!1,d=void 0,c=void 0,l=void 0;function f(t){!d&&(0,a.findSVGAtPoint)(t.clientX,t.clientY)&&((d=document.createElement("input")).setAttribute("id","pdf-annotate-text-input"),d.setAttribute("placeholder","Enter text"),d.style.border="3px solid "+a.BORDER_COLOR,d.style.borderRadius="3px",d.style.position="absolute",d.style.top=t.clientY+"px",d.style.left=t.clientX+"px",d.style.fontSize=c+"px",d.addEventListener("blur",v),d.addEventListener("keyup",m),document.body.appendChild(d),d.focus())}function v(){h()}function m(t){27===t.keyCode?y():13===t.keyCode&&h()}function h(){if(d.value.trim().length>0){var t=function(){var t=parseInt(d.style.left,10),e=parseInt(d.style.top,10),n=(0,a.findSVGAtPoint)(t,e);if(!n)return{v:void 0};var o=(0,a.getMetadata)(n),s=o.documentId,u=o.pageNumber,f=n.getBoundingClientRect(),p=Object.assign({type:"textbox",size:c,color:l,content:d.value.trim()},(0,a.scaleDown)(n,{x:t-f.left,y:e-f.top,width:d.offsetWidth,height:d.offsetHeight}));r.default.getStoreAdapter().addAnnotation(s,u,p).then(function(t){(0,i.default)(n,t)})}();if("object"===(void 0===t?"undefined":o(t)))return t.v}y()}function y(){d&&(d.removeEventListener("blur",v),d.removeEventListener("keyup",m),document.body.removeChild(d),d=null)}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{!o&&s.return&&s.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};e.createPage=function(t){var e=document.createElement("div");e.innerHTML=s;var n=e.children[0],o=n.querySelector("canvas");return n.setAttribute("id","pageContainer"+t),n.setAttribute("data-page-number",t),o.mozOpaque=!0,o.setAttribute("id","page"+t),n},e.renderPage=function(t,e,n){var a=e.documentId,s=e.pdfDocument,d=e.scale,c=e.rotate,l=s.getPage(t),f=r.default.getAnnotations(a,t),p=[l,f];return Promise.all(p).then(function(e){var a=o(e,2),s=a[0],l=a[1],f=document.getElementById("pageContainer"+t),p=f.querySelector(".annotationLayer"),v=f.querySelector(".canvasWrapper canvas"),m=v.getContext("2d",{alpha:!1}),h=s.getViewport(d,c),y=u(t,h,m),g=s.render({canvasContext:m,viewport:h,transform:y}),b=r.default.render(p,h,l);return Promise.all([g,b]).then(function(){return s.getTextContent({normalizeWhitespace:!0}).then(function(e){return new Promise(function(n,o){var r=f.querySelector(".textLayer"),a=new PDFJS.DefaultTextLayerFactory,s=a.createTextLayerBuilder(r,t-1,h);s.setTextContent(e),s.render(),setTimeout(function(){try{(0,i.default)(l.annotations),n()}catch(t){o(t)}})})})}).then(function(){return f.setAttribute("data-loaded","true"),n&&n(l.annotations,t),[s,l]})})},e.renderPageWithoutAnnotations=function(t,e,n){e.documentId;var a=e.pdfDocument,s=e.scale,d=e.rotate,c=[a.getPage(t),[]];return Promise.all(c).then(function(e){var a=o(e,2),c=a[0],l=[],f=document.getElementById("pageContainer"+t),p=f.querySelector(".annotationLayer"),v=f.querySelector(".canvasWrapper canvas"),m=v.getContext("2d",{alpha:!1}),h=c.getViewport(s,d),y=u(t,h,m),g=c.render({canvasContext:m,viewport:h,transform:y}),b=r.default.render(p,h,l);return Promise.all([g,b]).then(function(){return c.getTextContent({normalizeWhitespace:!0}).then(function(e){return new Promise(function(o,r){var a=f.querySelector(".textLayer"),s=new PDFJS.DefaultTextLayerFactory,u=s.createTextLayerBuilder(a,t-1,h);u.setTextContent(e),u.render(),setTimeout(function(){try{(0,i.default)(l.annotations),n&&n(),o()}catch(t){r(t)}})})})}).then(function(){return f.setAttribute("data-loaded","true"),[c,l]})})};var r=a(n(1)),i=a(n(20));function a(t){return t&&t.__esModule?t:{default:t}}var s='\n  <div style="visibility: hidden;" class="page" data-loaded="false">\n    <div class="canvasWrapper">\n      <canvas></canvas>\n    </div>\n    <svg class="annotationLayer"></svg>\n    <div class="textLayer"></div>\n  </div>\n';function u(t,e,n){var o,r,i,a,s=document.getElementById("pageContainer"+t),u=s.querySelector(".canvasWrapper canvas"),l=s.querySelector(".annotationLayer"),f=s.querySelector(".canvasWrapper"),p=s.querySelector(".textLayer"),v=(o=n,r=window.devicePixelRatio||1,i=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1,{sx:a=r/i,sy:a,scaled:1!==a}),m=v.scaled?[v.sx,0,0,v.sy,0,0]:null,h=d(v.sx),y=d(v.sy);return s.style.visibility="",u.width=c(e.width*v.sx,h[0]),u.height=c(e.height*v.sy,y[0]),u.style.width=c(e.width,h[1])+"px",u.style.height=c(e.height,h[1])+"px",l.setAttribute("width",e.width),l.setAttribute("height",e.height),l.style.width=e.width+"px",l.style.height=e.height+"px",s.style.width="100%",s.style.height=e.height+"px",f.style.width=e.width+"px",f.style.height=e.height+"px",p.style.width="100%",p.style.height=e.height+"px",$("#viewer").width(e.width),m}function d(t){if(Math.floor(t)===t)return[t,1];var e=1/t;if(e>8)return[1,8];if(Math.floor(e)===e)return[1,e];for(var n=t>1?e:t,o=0,r=1,i=1,a=1;;){var s=o+i,u=r+a;if(u>8)break;n<=s/u?(i=s,a=u):(o=s,r=u)}return n-o/r<i/a-n?n===t?[o,r]:[r,o]:n===t?[i,a]:[a,i]}function c(t,e){var n=t%e;return 0===n?t:Math.round(t-n+e)}}])},"object"===p(n)&&"object"===p(e)?e.exports=o():(a=[],void 0===(u="function"==typeof(i=o)?i.apply(n,a):i)||(e.exports=u))}).call(n,o(3)(e))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,o){function r(t){var e=arguments.length<=1||void 0===arguments[1]||arguments[1];c.setAttribute("data-color",t),c.style.background=t,e&&"function"==typeof o&&o(t),i()}function i(){document.removeEventListener("keyup",s),u&&u.parentNode&&u.parentNode.removeChild(u),d=!1,c.focus()}function a(t){var e=document.createElement("a");return e.className="color",e.setAttribute("href","javascript://"),e.setAttribute("title",t.name),e.setAttribute("data-color",t.hex),e.style.background=t.hex,e}function s(t){27===t.keyCode&&i()}var u=void 0,d=!1,c=a({hex:e});c.onclick=function(){d?i():(u||((u=document.createElement("div")).style.background="#fff",u.style.border="1px solid #ccc",u.style.padding="2px",u.style.position="absolute",u.style.width="122px",t.style.position="relative",n.map(a).forEach(function(t){t.style.margin="2px",t.onclick=function(){r(t.getAttribute("data-color"))},u.appendChild(t)})),document.addEventListener("keyup",s),t.appendChild(u),d=!0)},r(e,!1)};var n=[{hex:"#000000",name:"Black"},{hex:"#EF4437",name:"Red"},{hex:"#E71F63",name:"Pink"},{hex:"#8F3E97",name:"Purple"},{hex:"#65499D",name:"Deep Purple"},{hex:"#4554A4",name:"Indigo"},{hex:"#2083C5",name:"Blue"},{hex:"#35A4DC",name:"Light Blue"},{hex:"#09BCD3",name:"Cyan"},{hex:"#009688",name:"Teal"},{hex:"#43A047",name:"Green"},{hex:"#8BC34A",name:"Light Green"},{hex:"#FDC010",name:"Yellow"},{hex:"#F8971C",name:"Orange"},{hex:"#F0592B",name:"Deep Orange"},{hex:"#F06291",name:"Light Pink"}]}]);window.pdf_js_module=N}();